<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
<style>
    #contents{
        background-color: #ffffe0;
        width:1000px;
        height:500px;
        padding: 10px;
    }

</style>
</head>
<body>
    <button id="btnStu">학생데이터 가져오기</button>
    <div>
        <input id="stdID" placeholder="id">
        <input id="name" placeholder="name">
        <input id ="age" placeholder="age">
        <button id="btnAdd">학생데이터 추가</button>
        <button id="btnEdit">학생데이터 수정</button>
        <button id="btnDel">학생데이터 삭제</button>
    </div>
    <div id="contents">
        
    </div>
</body>
</html>
<script>
    window.onload = function(){
        let btnStu=document.getElementById("btnStu");
        let btnAdd= document.getElementById("btnAdd"); 
        let btnEdit= document.getElementById("btnEdit");
        let btnDel= document.getElementById("btnDel");
        btnStu.addEventListener("click",getStudents);
        btnAdd.addEventListener("click",postData);
        btnEdit.addEventListener("click",updateData);
        btnDel.addEventListener("click",deleteData);
    }
    function getStudents(){
        let contents=document.getElementById("contents");
        const xhr=new XMLHttpRequest();
        xhr.open("GET","http://localhost:3000/students");
        xhr.send();

        xhr.onload=()=>{
            if(xhr.status===200){
                const res= JSON.parse(xhr.response);
                contents.innerHTML = makeList(res);
            }else{
                console.log(xhr.status, xhr.statusText);
            }
        };
    }

    function makeList(data){
        let str ="<ul>";
        for (let key in data){
            str+="<li>"+ data[key].name+"("+data[key].age+")</li>";
        }
        str+="</ul>";
        return str;
    }

    function postData(){
        let contents=document.getElementById("contents");
        let stdID=document.getElementById("stdID");
        let name=document.getElementById("name");
        let age=document.getElementById("age");
        const xhr=new XMLHttpRequest();
        xhr.open("POST","http://localhost:3000/students");
        xhr.setRequestHeader("content-type","application/json;charset=UTF-8");
        const data={id:stdID.value, name: name.value, age:age.value};

        xhr.send(JSON.stringify(data));
        xhr.onload=()=>{
            if(xhr.status ===201){
                name.value="";
                age.value="";
                const res=JSON.parse(xhr.response);
                getStudents();
            }else{
                console.log(xhr.status,xhr.statusText);
            }
        }
    }

    function updateData(){
        const id=document.getElementById("stdID").value;
        const name= document.getElementById("name").value;
        const age= document.getElementById("age").value;

        const xhr= new XMLHttpRequest();
        xhr.open("PUT","http://localhost:3000/students/"+id);
        xhr.setRequestHeader("content-type","application/json; charset=UTF-8");

        const data={id: id, name:name ,age: age};
        xhr.send(JSON.stringify(data));

        xhr.onload=()=>{
            if(xhr.status===200){
                const res =JSON.parse(xhr.response);
                console.log(res);
                getStudents();
            }else{
                console.log(xhr.status,xhr.statusText);
            }
        }
    }

    function deleteData(){
        const id= document.getElementById("stdID").value;
        
        const xhr =new XMLHttpRequest();
        xhr.open("DELETE","http://localhost:3000/students/"+id);
        xhr.send();
        
        xhr.onload= ()=>{
            if(xhr.status===200){
                getStudents();
            }else{
                console.log(xhr.status,xhr.statusText);
            };
        }
    }
</script>